<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개념 맵 도구 - 전통적인 방식</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .concept-map-container {
            display: flex;
            height: 100vh;
            background-color: #f5f5f5;
        }

        /* 왼쪽 개념 패널 */
        .concept-panel {
            width: 300px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            overflow-y: auto;
            border-right: 3px solid #34495e;
        }

        .concept-panel h3 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 18px;
            color: #ecf0f1;
            text-align: center;
            border-bottom: 2px solid #34495e;
            padding-bottom: 10px;
        }

        .concept-tags {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .concept-tag {
            background-color: #3498db;
            color: white;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .concept-tag:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .concept-tag:active {
            cursor: grabbing;
            transform: scale(0.95);
            opacity: 0.8;
        }

        /* 오른쪽 캔버스 영역 */
        .canvas-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .canvas {
            width: 100%;
            height: 100%;
            position: relative;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .relationship-label {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* 배치된 태그들 */
        .placed-tag {
            position: absolute;
            background-color: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: 500;
            z-index: 2;
            min-width: 80px;
            text-align: center;
        }

        .placed-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .placed-tag.selected {
            background-color: #f39c12;
            border: 3px solid #f1c40f;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(241, 196, 64, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(241, 196, 64, 0); }
            100% { box-shadow: 0 0 0 0 rgba(241, 196, 64, 0); }
        }

        /* 다이얼로그 */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .dialog-overlay.show {
            display: flex;
        }

        .dialog {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .dialog h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            font-size: 24px;
        }

        .dialog p {
            margin-bottom: 20px;
            color: #7f8c8d;
            text-align: center;
        }

        .selected-concepts {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .selected-concept {
            background-color: #3498db;
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: 500;
        }

        .relationship-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 25px;
        }

        .relationship-buttons button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .relationship-buttons button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .dialog-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .dialog-actions button {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .dialog-actions button:hover {
            background-color: #7f8c8d;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .concept-map-container {
                flex-direction: column;
            }
            
            .concept-panel {
                width: 100%;
                height: 200px;
                order: 2;
            }
            
            .canvas-container {
                height: calc(100vh - 200px);
                order: 1;
            }
            
            .concept-tags {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .concept-tag {
                flex: 0 0 auto;
                min-width: 80px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* 스크롤바 스타일링 */
        .concept-panel::-webkit-scrollbar {
            width: 8px;
        }

        .concept-panel::-webkit-scrollbar-track {
            background: #34495e;
        }

        .concept-panel::-webkit-scrollbar-thumb {
            background: #4a6741;
            border-radius: 4px;
        }

        .concept-panel::-webkit-scrollbar-thumb:hover {
            background: #5dade2;
        }
    </style>
</head>
<body>
    <div class="concept-map-container">
        <!-- 왼쪽 개념 패널 -->
        <div class="concept-panel">
            <h3>개념 목록</h3>
            <div class="concept-tags" id="conceptTags">
                <!-- JavaScript로 동적 생성 -->
            </div>
        </div>

        <!-- 오른쪽 캔버스 영역 -->
        <div class="canvas-container">
            <div class="canvas" id="canvas">
                <!-- SVG for 연결선 -->
                <svg class="connection-svg" id="connectionSvg" width="100%" height="100%">
                    <!-- 화살표 마커 정의 -->
                    <defs>
                        <marker
                            id="arrowhead"
                            markerWidth="10"
                            markerHeight="7"
                            refX="9"
                            refY="3.5"
                            orient="auto"
                        >
                            <polygon
                                points="0 0, 10 3.5, 0 7"
                                fill="#4A90E2"
                            />
                        </marker>
                    </defs>
                </svg>
                <!-- 배치된 태그들은 JavaScript로 동적 생성 -->
            </div>
        </div>
    </div>

    <!-- 관계 정의 다이얼로그 -->
    <div class="dialog-overlay" id="dialogOverlay">
        <div class="dialog">
            <h3>관계 정의</h3>
            <p>선택한 두 개념 간의 관계를 정의해주세요:</p>
            <div class="selected-concepts" id="selectedConcepts">
                <!-- JavaScript로 동적 생성 -->
            </div>
            <div class="relationship-buttons">
                <button onclick="createRelationship('포함')">포함</button>
                <button onclick="createRelationship('구성')">구성</button>
                <button onclick="createRelationship('연관')">연관</button>
                <button onclick="createRelationship('대립')">대립</button>
                <button onclick="createRelationship('유사')">유사</button>
                <button onclick="createRelationship('원인')">원인</button>
                <button onclick="createRelationship('결과')">결과</button>
            </div>
            <div class="dialog-actions">
                <button onclick="closeDialog()">취소</button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수들
        let draggedConcept = null;
        let placedTags = [];
        let selectedTags = [];
        let connections = [];
        let tagIdCounter = 1;

        // 개념 목록
        const concepts = [
            '자연수', '분수', '소수', '0',
            '덧셈', '뺄셈', '곱셈', '나눗셈',
            '평면도형', '입체도형', '시간',
            '길이', '들레', '부피', '높이',
            '무게', '각도', '넓이', '길넓이',
            '그래프', '사건이 일어날 가능성',
            '약수', '공약수', '최대공약수',
            '배수', '공배수', '최소공배수',
            '짝수', '홀수', '단위분수',
            '진분수', '가분수', '대분수'
        ];

        // DOM 요소들
        const conceptTagsContainer = document.getElementById('conceptTags');
        const canvas = document.getElementById('canvas');
        const connectionSvg = document.getElementById('connectionSvg');
        const dialogOverlay = document.getElementById('dialogOverlay');
        const selectedConceptsContainer = document.getElementById('selectedConcepts');

        // 초기화
        function init() {
            createConceptTags();
            setupCanvasEvents();
        }

        // 개념 태그들 생성
        function createConceptTags() {
            concepts.forEach(concept => {
                const tagElement = document.createElement('div');
                tagElement.className = 'concept-tag';
                tagElement.textContent = concept;
                tagElement.draggable = true;
                
                // 드래그 이벤트
                tagElement.addEventListener('dragstart', (e) => {
                    draggedConcept = concept;
                    e.dataTransfer.effectAllowed = 'copy';
                });
                
                conceptTagsContainer.appendChild(tagElement);
            });
        }

        // 캔버스 이벤트 설정
        function setupCanvasEvents() {
            canvas.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            canvas.addEventListener('drop', (e) => {
                e.preventDefault();
                if (!draggedConcept) return;

                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // 새 태그 생성
                const newTag = {
                    id: tagIdCounter++,
                    concept: draggedConcept,
                    x: x - 50, // 태그 중앙 정렬을 위한 오프셋
                    y: y - 20,
                    selected: false
                };

                placedTags.push(newTag);
                createPlacedTagElement(newTag);
                draggedConcept = null;
            });
        }

        // 배치된 태그 요소 생성
        function createPlacedTagElement(tag) {
            const tagElement = document.createElement('div');
            tagElement.className = 'placed-tag';
            tagElement.textContent = tag.concept;
            tagElement.style.left = tag.x + 'px';
            tagElement.style.top = tag.y + 'px';
            tagElement.dataset.tagId = tag.id;

            // 클릭 이벤트
            tagElement.addEventListener('click', () => {
                handleTagClick(tag.id);
            });

            canvas.appendChild(tagElement);
        }

        // 태그 클릭 처리
        function handleTagClick(tagId) {
            // 태그 선택 상태 토글
            const tag = placedTags.find(t => t.id === tagId);
            if (!tag) return;

            tag.selected = !tag.selected;
            
            // 시각적 업데이트
            const tagElement = document.querySelector(`[data-tag-id="${tagId}"]`);
            if (tag.selected) {
                tagElement.classList.add('selected');
                if (!selectedTags.includes(tagId)) {
                    selectedTags.push(tagId);
                }
            } else {
                tagElement.classList.remove('selected');
                selectedTags = selectedTags.filter(id => id !== tagId);
            }

            // 2개가 선택되면 다이얼로그 표시
            if (selectedTags.length === 2) {
                showDialog();
            }
        }

        // 다이얼로그 표시
        function showDialog() {
            // 선택된 개념들 표시
            selectedConceptsContainer.innerHTML = '';
            selectedTags.forEach(tagId => {
                const tag = placedTags.find(t => t.id === tagId);
                if (tag) {
                    const conceptSpan = document.createElement('span');
                    conceptSpan.className = 'selected-concept';
                    conceptSpan.textContent = tag.concept;
                    selectedConceptsContainer.appendChild(conceptSpan);
                }
            });

            dialogOverlay.classList.add('show');
        }

        // 관계 생성
        function createRelationship(relationshipType) {
            if (selectedTags.length !== 2) return;

            const tag1 = placedTags.find(tag => tag.id === selectedTags[0]);
            const tag2 = placedTags.find(tag => tag.id === selectedTags[1]);

            if (!tag1 || !tag2) return;

            const newConnection = {
                id: Date.now(),
                from: tag1,
                to: tag2,
                relationship: relationshipType,
                fromX: tag1.x + 50, // 태그 중앙
                fromY: tag1.y + 20,
                toX: tag2.x + 50,
                toY: tag2.y + 20
            };

            connections.push(newConnection);
            drawConnection(newConnection);
            
            // 선택 해제
            clearSelection();
            closeDialog();
        }

        // 연결선 그리기
        function drawConnection(connection) {
            // 선 그리기
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', connection.fromX);
            line.setAttribute('y1', connection.fromY);
            line.setAttribute('x2', connection.toX);
            line.setAttribute('y2', connection.toY);
            line.setAttribute('stroke', '#4A90E2');
            line.setAttribute('stroke-width', '2');
            line.setAttribute('marker-end', 'url(#arrowhead)');

            // 관계 라벨
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', (connection.fromX + connection.toX) / 2);
            text.setAttribute('y', (connection.fromY + connection.toY) / 2 - 5);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('font-size', '12');
            text.setAttribute('fill', '#333');
            text.className = 'relationship-label';
            text.textContent = connection.relationship;

            connectionSvg.appendChild(line);
            connectionSvg.appendChild(text);
        }

        // 선택 해제
        function clearSelection() {
            selectedTags = [];
            placedTags.forEach(tag => {
                tag.selected = false;
                const tagElement = document.querySelector(`[data-tag-id="${tag.id}"]`);
                if (tagElement) {
                    tagElement.classList.remove('selected');
                }
            });
        }

        // 다이얼로그 닫기
        function closeDialog() {
            dialogOverlay.classList.remove('show');
            clearSelection();
        }

        // 다이얼로그 오버레이 클릭 시 닫기
        dialogOverlay.addEventListener('click', (e) => {
            if (e.target === dialogOverlay) {
                closeDialog();
            }
        });

        // ESC 키로 다이얼로그 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && dialogOverlay.classList.contains('show')) {
                closeDialog();
            }
        });

        // 초기화 실행
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
